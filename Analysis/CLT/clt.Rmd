---
title: "CLT"
author: "Martín Ramírez Espinosa & Sergio Alejandro González Osorio"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Experimento

Se toma una urna con 12 valores distintos, se extraen 9 bolas con reemplazo y se calcula la media de cada muestra. Este procedimiento se repite 50 veces para estudiar cómo se comporta la distribución de las medias muestrales.

## Preparación de los datos

```{r load-data}
dataset_path <- if (file.exists("dataset.csv")) {
  "dataset.csv"
} else if (file.exists(file.path("Analysis", "CLT", "dataset.csv"))) {
  file.path("Analysis", "CLT", "dataset.csv")
} else {
  stop("No se encontró el archivo dataset.csv.")
}

clt_data <- read.csv(dataset_path)
sample_means <- clt_data$mean

knitr::kable(head(clt_data[, c("sample", "mean")]),
             col.names = c("Muestra", "Media"),
             caption = "Primeras medias muestrales registradas.")
```

## Gran media de las medias

La **gran media** corresponde al promedio de las 50 medias muestrales. Según el Teorema del Límite Central (TLC), esta cantidad es un estimador insesgado de la media poblacional y su dispersión se reduce conforme aumenta el número de réplicas. En este caso obtenemos:

```{r grand-mean, results='asis'}
grand_mean <- mean(sample_means)
sd_means <- sd(sample_means)
se_grand_mean <- sd_means / sqrt(length(sample_means))

summary_tbl <- data.frame(
  Estadístico = c("Número de réplicas", "Gran media", "Desviación de las medias", "Error estándar de la gran media"),
  Valor = c(length(sample_means),
            round(grand_mean, 2),
            round(sd_means, 2),
            round(se_grand_mean, 2))
)

knitr::kable(summary_tbl,
             align = "lc",
             caption = "Resumen numérico de las medias muestrales.")
```

La gran media obtenida es `r round(grand_mean, 2)`, lo que resume la tendencia central de las 50 medias. El error estándar (`r round(se_grand_mean, 2)`) cuantifica la incertidumbre asociada a este estimador.

## Evidencia gráfica del TLC

Como las medias posibles solo toman valores discretos, es más apropiado representar sus frecuencias relativas mediante un gráfico de tallos (similar a `np.stem`) en lugar de un histograma de barras.

```{r stem-plot, fig.cap="Frecuencia relativa de las medias muestrales y función normal aproximada"}
unique_means <- sort(unique(sample_means))
freq_table <- table(factor(sample_means, levels = unique_means))
rel_freq <- as.numeric(freq_table) / length(sample_means)

plot(unique_means, rel_freq,
     type = "h",
     lwd = 6,
     lend = "butt",
     col = "#0D47A1",
     main = "Medias muestrales (n = 9)",
     xlab = "Media de cada muestra",
     ylab = "Frecuencia relativa")
points(unique_means, rel_freq, pch = 16, col = "#0D47A1")

curve(dnorm(x, mean = grand_mean, sd = sd_means),
      add = TRUE,
      col = "#E53935",
      lwd = 2)

legend("topright",
       legend = c("Frecuencia relativa", "Aproximación normal"),
       col = c("#0D47A1", "#E53935"),
       lwd = c(6, 2),
       pch = c(16, NA),
       bty = "n")

normal_expr <- bquote(phi(x) == frac(1, .(round(sd_means, 2)) * sqrt(2 * pi)) *
                        exp(-((x - .(round(grand_mean, 2)))^2) /
                              (2 * .(round(sd_means, 2)^2))))
mtext(normal_expr, side = 3, line = 0.5, col = "#E53935", cex = 0.85)
```

Los tallos azules muestran las probabilidades empíricas de cada media observada, mientras que la curva roja representa la densidad normal
\[
\phi(x) = \frac{1}{\sigma_{\bar{X}}\sqrt{2\pi}}
          \exp\!\left(-\frac{(x - \mu_{\bar{X}})^2}{2\sigma_{\bar{X}}^2}\right),
\]
con `r round(grand_mean, 2)` como media y `r round(sd_means, 2)` como desviación. La superposición ilustra el Teorema del Límite Central: aun con datos discretos, la distribución de las medias converge rápidamente hacia la forma normal al incrementar el número de repeticiones.
